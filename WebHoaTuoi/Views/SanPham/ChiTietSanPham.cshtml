@model WebHoaTuoi.Models.SanPham

@{
    ViewBag.Title = "Chi Tiết Sản Phẩm";
    Layout = "~/Views/Shared/_myLayout.cshtml";
}

<style>
    .product-detail-container {
        background-color: white;
        border-radius: 15px;
        padding: 40px;
        box-shadow: 0 3px 15px rgba(0,0,0,0.1);
    }

    .breadcrumb-custom {
        background-color: transparent;
        padding: 0 0 20px 0;
        margin: 0;
    }

        .breadcrumb-custom li {
            display: inline;
            color: #666;
        }

            .breadcrumb-custom li + li:before {
                content: " > ";
                padding: 0 8px;
            }

        .breadcrumb-custom a {
            color: #ff6b9d;
            text-decoration: none;
        }

            .breadcrumb-custom a:hover {
                text-decoration: underline;
            }

    .product-detail-layout {
        display: flex;
        gap: 40px;
        margin-bottom: 40px;
    }

    .product-image-section {
        flex: 1;
        max-width: 500px;
    }

    .main-image {
        width: 100%;
        height: 500px;
        object-fit: cover;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        margin-bottom: 15px;
    }

    .image-placeholder {
        width: 100%;
        height: 500px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 80px;
        color: #999;
    }

    .product-info-section {
        flex: 1;
    }

    .product-category-badge {
        display: inline-block;
        background: linear-gradient(135deg, #ff6b9d 0%, #c06c84 100%);
        color: white;
        padding: 8px 20px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 15px;
    }

    .product-title {
        font-size: 32px;
        font-weight: bold;
        color: #333;
        margin: 0 0 20px 0;
        line-height: 1.3;
    }

    .product-rating {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
    }

    .stars {
        color: #ffa500;
        font-size: 20px;
    }

    .rating-text {
        color: #666;
        font-size: 14px;
    }

    .product-price-section {
        background: linear-gradient(135deg, #fff5f8 0%, #ffe4ec 100%);
        padding: 25px;
        border-radius: 10px;
        margin: 25px 0;
        border: 2px solid #ff6b9d;
    }

    .product-price {
        font-size: 36px;
        font-weight: bold;
        color: #ff6b9d;
        margin: 0;
    }

    .price-label {
        font-size: 14px;
        color: #666;
        margin-bottom: 5px;
    }

    .product-stock {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #ffcdd8;
    }

    .stock-status {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 16px;
    }

    .stock-available {
        color: #27ae60;
    }

    .stock-unavailable {
        color: #e74c3c;
    }

    .product-quantity {
        margin: 30px 0;
    }

    .quantity-label {
        font-weight: 600;
        color: #333;
        margin-bottom: 10px;
        display: block;
    }

    .quantity-selector {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .quantity-btn {
        width: 40px;
        height: 40px;
        border: 2px solid #ff6b9d;
        background-color: white;
        color: #ff6b9d;
        font-size: 20px;
        font-weight: bold;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
    }

        .quantity-btn:hover:not(:disabled) {
            background-color: #ff6b9d;
            color: white;
        }

        .quantity-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

    .quantity-input {
        width: 80px;
        height: 40px;
        text-align: center;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 18px;
        font-weight: 600;
    }

    .product-actions {
        display: flex;
        gap: 15px;
        margin-top: 30px;
    }

    .btn-add-cart {
        flex: 2;
        padding: 18px;
        background: linear-gradient(135deg, #ff6b9d 0%, #c06c84 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

        .btn-add-cart:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.4);
        }

        .btn-add-cart:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

    .btn-buy-now {
        flex: 1;
        padding: 18px;
        background-color: white;
        color: #ff6b9d;
        border: 2px solid #ff6b9d;
        border-radius: 10px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
    }

        .btn-buy-now:hover {
            background-color: #ff6b9d;
            color: white;
        }

    .product-description {
        margin-top: 40px;
        padding-top: 40px;
        border-top: 2px solid #eee;
    }

    .description-title {
        font-size: 24px;
        font-weight: bold;
        color: #333;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .description-content {
        line-height: 1.8;
        color: #666;
        font-size: 16px;
    }

    .product-features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 30px;
    }

    .feature-item {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        transition: all 0.3s;
    }

        .feature-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

    .feature-icon {
        font-size: 40px;
        margin-bottom: 10px;
    }

    .feature-text {
        font-weight: 600;
        color: #333;
    }

    .back-link {
        display: inline-block;
        margin-top: 30px;
        color: #ff6b9d;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
    }

        .back-link:hover {
            color: #c06c84;
            padding-left: 10px;
        }

    /* Responsive */
    @@media (max-width: 768px) {
        .product-detail-layout {
            flex-direction: column;
        }

        .product-image-section {
            max-width: 100%;
        }

        .main-image {
            height: 350px;
        }

        .product-title {
            font-size: 24px;
        }

        .product-price {
            font-size: 28px;
        }

        .product-actions {
            flex-direction: column;
        }
    }
</style>

<!-- Breadcrumb -->
<ul class="breadcrumb-custom">
    <li><a href="@Url.Action("Index", "Home")">Trang chủ</a></li>
    <li><a href="@Url.Action("Index", "SanPham")">Sản phẩm</a></li>
    <li>@Model.TenSP</li>
</ul>

<div class="product-detail-container">
    <div class="product-detail-layout">
        <!-- Hình ảnh sản phẩm -->
        <div class="product-image-section">
            @if (!string.IsNullOrEmpty(Model.Hinh))
            {
                <img src="@Url.Content("~/Images/" + Model.Hinh)"
                     alt="@Model.TenSP"
                     class="main-image"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="image-placeholder" style="display: none;">
                    🌸
                </div>
            }
            else
            {
                <div class="image-placeholder">
                    🌸
                </div>
            }
        </div>

        <!-- Thông tin sản phẩm -->
        <div class="product-info-section">
            <!-- Danh mục -->
            <span class="product-category-badge">
                @(Model.LoaiSP != null ? Model.LoaiSP.TenLoaiSP : "Chưa phân loại")
            </span>

            <!-- Tên sản phẩm -->
            <h1 class="product-title">@Model.TenSP</h1>

            <!-- Đánh giá -->
            <div class="product-rating">
                <span class="stars">⭐⭐⭐⭐⭐</span>
                <span class="rating-text">(128 đánh giá)</span>
            </div>

            <!-- Giá và tình trạng -->
            <div class="product-price-section">
                <div class="price-label">Giá bán:</div>
                <div class="product-price">@Model.DonGia.ToString("N0")đ</div>

                <div class="product-stock">
                    @if (Model.SoLuong > 0)
                    {
                        <span class="stock-status stock-available">
                            ✓ Còn hàng (@Model.SoLuong sản phẩm)
                        </span>
                    }
                    else
                    {
                        <span class="stock-status stock-unavailable">
                            ✗ Hết hàng
                        </span>
                    }
                </div>
            </div>

            <!-- Chọn số lượng -->
            @if (Model.SoLuong > 0)
            {
                <div class="product-quantity">
                    <label class="quantity-label">Số lượng:</label>
                    <div class="quantity-selector">
                        <button type="button" class="quantity-btn" onclick="decreaseQuantity()">-</button>
                        <input type="number" id="quantity" class="quantity-input" value="1" min="1" max="@Model.SoLuong" readonly>
                        <button type="button" class="quantity-btn" onclick="increaseQuantity()">+</button>
                    </div>
                </div>

                <!-- Nút hành động -->
                <div class="product-actions">
                    <button class="btn-add-cart" onclick="addToCartFromDetail()">
                        Thêm Vào Giỏ Hàng
                    </button>
                    <button class="btn-buy-now" onclick="buyNow()">
                        💳 Mua Ngay
                    </button>
                </div>
            }
            else
            {
                <div class="product-actions">
                    <button class="btn-add-cart" disabled>
                        Sản Phẩm Đã Hết Hàng
                    </button>
                </div>
            }
        </div>
    </div>

    <!-- Mô tả sản phẩm -->
    <div class="product-description">
        <h2 class="description-title">📝 Mô Tả Sản Phẩm</h2>
        <div class="description-content">
            <p>
                <strong>@Model.TenSP</strong> là sự lựa chọn hoàn hảo để thể hiện tình cảm và sự quan tâm của bạn.
                Với vẻ đẹp tươi mới và hương thơm dịu nhẹ, sản phẩm này phù hợp cho mọi dịp đặc biệt.
            </p>

            <p>🌸 <strong>Đặc điểm nổi bật:</strong></p>
            <ul style="margin-left: 20px; line-height: 2;">
                <li>Hoa tươi 100%, nhập khẩu từ các vườn hoa uy tín</li>
                <li>Được chăm sóc kỹ lưỡng trước khi giao đến tay khách hàng</li>
                <li>Thiết kế tinh tế, phù hợp với mọi không gian</li>
                <li>Bảo quản được từ 5-7 ngày trong điều kiện thích hợp</li>
            </ul>

            <p>
                💝 <strong>Ý nghĩa:</strong> @Model.TenSP mang trong mình thông điệp về tình yêu, sự trân trọng
                và những điều tốt đẹp trong cuộc sống. Đây là món quà tuyệt vời để gửi gắm những cảm xúc chân thành.
            </p>
        </div>

        <!-- Tính năng -->
        <div class="product-features">
            <div class="feature-item">
                <div class="feature-icon">🚚</div>
                <div class="feature-text">Giao hàng nhanh</div>
                <p style="font-size: 13px; color: #999; margin-top: 5px;">Trong 2 giờ</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">✅</div>
                <div class="feature-text">Đảm bảo chất lượng</div>
                <p style="font-size: 13px; color: #999; margin-top: 5px;">100% tươi mới</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">🎁</div>
                <div class="feature-text">Quà tặng kèm</div>
                <p style="font-size: 13px; color: #999; margin-top: 5px;">Thiệp miễn phí</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">💰</div>
                <div class="feature-text">Hoàn tiền</div>
                <p style="font-size: 13px; color: #999; margin-top: 5px;">Nếu không hài lòng</p>
            </div>
        </div>
    </div>

    <!-- Nút quay lại -->
    <a href="@Url.Action("Index", "SanPham")" class="back-link">
        ← Quay lại danh sách sản phẩm
    </a>
</div>

<script>
    var maxQuantity = @Model.SoLuong;
    var productId = '@Model.MaSP';
    var productName = '@Model.TenSP';
    var productPrice = @Model.DonGia;
    var productImage = '@Model.Hinh';

    // Tăng số lượng
    function increaseQuantity() {
        var input = document.getElementById('quantity');
        var currentValue = parseInt(input.value);
        if (currentValue < maxQuantity) {
            input.value = currentValue + 1;
        }
    }

    // Giảm số lượng
    function decreaseQuantity() {
        var input = document.getElementById('quantity');
        var currentValue = parseInt(input.value);
        if (currentValue > 1) {
            input.value = currentValue - 1;
        }
    }

    // Thêm vào giỏ hàng từ trang chi tiết
    function addToCartFromDetail() {
        var quantity = parseInt(document.getElementById('quantity').value);

        // Gọi hàm addToCart từ _myLayout
        if (typeof addToCart === 'function') {
            // Thêm nhiều lần theo số lượng
            for (var i = 0; i < quantity; i++) {
                if (i === 0) {
                    addToCart(productId, productName, productPrice, productImage);
                } else {
                    // Thêm thầm lặng không alert
                    var cart = JSON.parse(localStorage.getItem('cart')) || [];
                    var existingItem = cart.find(function(item) { return item.id === productId; });
                    if (existingItem) {
                        existingItem.quantity++;
                    }
                    localStorage.setItem('cart', JSON.stringify(cart));
                }
            }

            // Cập nhật số lượng badge
            if (typeof updateCartCount === 'function') {
                updateCartCount();
            }
        }
    }

    // Mua ngay
    function buyNow() {
        addToCartFromDetail();
    }
</script>